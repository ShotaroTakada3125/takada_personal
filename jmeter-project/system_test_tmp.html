<!DOCTYPE html>
<html>
<head>
<title>system_test.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<h1 id="jmeter%E3%82%B7%E3%83%8A%E3%83%AA%E3%82%AA%E4%BD%9C%E6%88%90%E3%83%BB%E5%AE%9F%E8%A1%8C%E6%89%8B%E9%A0%86%E6%9B%B8">JMeterシナリオ作成・実行手順書</h1>
<h2 id="%E7%9B%AE%E6%AC%A1">目次</h2>
<ol>
<li><a href="#1-%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB">はじめに</a></li>
<li><a href="#2-%E7%92%B0%E5%A2%83%E6%A7%8B%E7%AF%89-setup">環境構築 (Setup)</a></li>
<li><a href="#3-%E3%82%B7%E3%83%8A%E3%83%AA%E3%82%AA%E4%BD%9C%E6%88%90-scenario-design">シナリオ作成 (Scenario Design)</a></li>
<li><a href="#4-%E8%B2%A0%E8%8D%B7%E8%A9%A6%E9%A8%93%E8%A8%AD%E5%AE%9A-load-configuration">負荷試験設定 (Load Configuration)</a></li>
<li><a href="#5-%E3%83%86%E3%82%B9%E3%83%88%E5%AE%9F%E8%A1%8C-execution">テスト実行 (Execution)</a></li>
<li><a href="#6-%E3%83%AC%E3%83%9D%E3%83%BC%E3%83%88%E8%A7%A3%E6%9E%90-result-analysis">レポート解析 (Result Analysis)</a></li>
<li><a href="#appendix-a-%E3%83%97%E3%83%AD%E3%82%AD%E3%82%B7%E3%81%A8https%E8%A8%BC%E6%98%8E%E6%9B%B8%E3%81%AE%E8%A8%AD%E5%AE%9A%E8%A9%B3%E7%B4%B0">Appendix A. プロキシとHTTPS証明書の設定詳細</a></li>
<li><a href="#appendix-b-%E3%83%A1%E3%83%BC%E3%83%AB%E5%8F%96%E5%BE%97%E6%A9%9F%E8%83%BD-mail-reader-sampler">Appendix B. メール取得機能 (Mail Reader Sampler)</a></li>
</ol>
<h2 id="1-%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB">1. はじめに</h2>
<p>本ドキュメントは、負荷試験におけるJMeterのセットアップ、シナリオ作成、および実行手順をまとめたものである。</p>
<h3 id="1-1-jmeter%E6%A6%82%E8%A6%81">1-1. JMeter概要</h3>
<p>Apache JMeterは、Webアプリケーション等のパフォーマンス測定と負荷テストを行うためのオープンソースソフトウェア（Java製）である。</p>
<ul>
<li><strong>主な機能:</strong>
<ul>
<li><strong>負荷生成:</strong> 静的・動的なリソース（Web, API, DB等）に対し、大量の同時アクセスをシミュレートする。</li>
<li><strong>性能測定:</strong> スループット（RPS）、応答時間（Latency）、エラー率などを計測する。</li>
<li><strong>拡張性:</strong> プラグインにより、機能やグラフ表示を拡張可能。</li>
</ul>
</li>
</ul>
<h3 id="1-2-%E8%B2%A0%E8%8D%B7%E8%A9%A6%E9%A8%93%E3%81%AE%E3%82%B4%E3%83%BC%E3%83%AB%E8%A8%AD%E5%AE%9A-slosla">1-2. 負荷試験のゴール設定 (SLO/SLA)</h3>
<p>シナリオ作成を開始する前に、必ず「何をもって試験合格とするか」を定量的に定義する。
各プロジェクトで確認すること。</p>
<h2 id="2-%E7%92%B0%E5%A2%83%E6%A7%8B%E7%AF%89-setup">2. 環境構築 (Setup)</h2>
<h3 id="2-1-%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%A8%E6%97%A5%E6%9C%AC%E8%AA%9E%E5%8C%96">2-1. インストールと日本語化</h3>
<ol>
<li>
<p><strong>Javaのインストール</strong>
JMeterの実行にはJava環境（JDK）が必要である。未導入の場合はインストールする。</p>
</li>
<li>
<p><strong>JMeterのインストール</strong>
ターミナルで以下のコマンドを実行する。</p>
</li>
</ol>
<pre class="hljs"><code><div>brew install jmeter
</div></code></pre>
<blockquote>
<p><strong>Note:</strong> Windowsの場合は公式サイトからダウンロードすること。<a href="https://ptune.jp/tech/jmeter-installation-and-initial-setup/">（参考）</a></p>
</blockquote>
<ol start="3">
<li>
<p><strong>日本語環境の設定（恒久対応）</strong>
起動スクリプトを直接編集し、JMeter起動時の言語設定を恒久的に日本語にする。</p>
<p>JMeterのbinディレクトリへ移動し、起動スクリプト(<code>jmeter</code>)をテキストエディタで開き、以下のように修正する。</p>
</li>
</ol>
<pre class="hljs"><code><div><span class="hljs-comment"># ディレクトリ移動</span>
<span class="hljs-built_in">cd</span> $(brew --prefix jmeter)/libexec/bin
</div></code></pre>
<pre class="hljs"><code><div><span class="hljs-comment"># --- 修正前 ---</span>
: <span class="hljs-string">"<span class="hljs-variable">${JMETER_LANGUAGE:=-Duser.language=en -Duser.region=EN}</span>"</span>

<span class="hljs-comment"># --- 修正後 ---</span>
: <span class="hljs-string">"<span class="hljs-variable">${JMETER_LANGUAGE:=-Duser.language=ja -Duser.region=JP}</span>"</span>
</div></code></pre>
<blockquote>
<p><strong>Note:</strong> HomebrewでJMeter自体をアップデート(brew upgrade)すると、このファイルは上書きされ設定が初期化される場合がある。その際は再度この手順を実施すること。</p>
</blockquote>
<h3 id="2-2-%E3%83%97%E3%83%A9%E3%82%B0%E3%82%A4%E3%83%B3%E3%81%AE%E5%B0%8E%E5%85%A5">2-2. プラグインの導入</h3>
<p>既存の機能では時間経過ごとに細かくスループット(RequestPerSecond)を設定できない。<br>
<code>Throughput Shaping Timer</code>というプラグインの導入手順を示す。</p>
<ol>
<li><a href="https://jmeter-plugins.org/?search=jpgc-tst">Throughput Shaping Timer ダウンロードページ</a>へアクセスし、最新のzipファイルをダウンロードする。</li>
</ol>
<p><img src="file:///Users/takada/Desktop/takada_personal/jmeter-project/docs/images/0-6.png" alt="Throughput Shaping Timerのダウンロードサイト"></p>
<ol start="2">
<li>ダウンロードしたファイルを解凍し、以下を確認する。</li>
</ol>
<p><img src="file:///Users/takada/Desktop/takada_personal/jmeter-project/docs/images/0-8.png" alt="ファイルの確認"></p>
<ol start="3">
<li><strong>ライブラリの配置</strong>
解凍した <code>.jar</code> ファイルをJMeterのライブラリフォルダへ配置する。</li>
</ol>
<pre class="hljs"><code><div>cp *.jar $(brew --prefix jmeter)/libexec/lib/
cp ext/*.jar $(brew --prefix jmeter)/libexec/lib/ext/
</div></code></pre>
<ol start="4">
<li><strong>起動確認</strong>
JMeterを起動する。</li>
</ol>
<p><img src="file:///Users/takada/Desktop/takada_personal/jmeter-project/docs/images/0-10.png" alt="JMeter起動"></p>
<ol start="5">
<li><strong>GUI設定</strong>
<code>オプション</code> → <code>ルック＆フィール</code> から <strong>System</strong> を選択する（推奨）。</li>
</ol>
<p><img src="file:///Users/takada/Desktop/takada_personal/jmeter-project/docs/images/GUI_setting.png" alt="ルック＆フィール設定"></p>
<hr>
<h2 id="3-%E3%82%B7%E3%83%8A%E3%83%AA%E3%82%AA%E4%BD%9C%E6%88%90-scenario-design">3. シナリオ作成 (Scenario Design)</h2>
<p>本章では、JMeterで負荷試験をするために、シナリオを作成する方法を記述する。<br>
なお、JMeterのシナリオファイル(.jmx)はXML形式であり、競合時のマージが困難のためバージョン管理(Git)が推奨される。</p>
<blockquote>
<p><strong>Warning:</strong> レポートファイル（.jtl, .html）やログファイルは容量が大きくなるため、管理の場合は<code>.gitignore</code> に追加するなど対応すること。</p>
</blockquote>
<h3 id="3-1-%E3%83%97%E3%83%AD%E3%82%AD%E3%82%B7%E3%83%AC%E3%82%B3%E3%83%BC%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0-http-proxy-server">3-1. プロキシレコーディング (HTTP Proxy Server)</h3>
<p>ブラウザの操作を記録してベースとなるスクリプトを作成する。</p>
<p><strong>※ 初回実施時のみ、HTTPS通信の復号化に必要な証明書設定が必要となる。詳細は <a href="#appendix-a-%E3%83%97%E3%83%AD%E3%82%AD%E3%82%B7%E3%81%A8https%E8%A8%BC%E6%98%8E%E6%9B%B8%E3%81%AE%E8%A8%AD%E5%AE%9A%E8%A9%B3%E7%B4%B0">Appendix A. プロキシとHTTPS証明書の設定詳細</a> を参照のこと。</strong></p>
<ol>
<li>
<p><strong>スレッドグループの作成</strong>
テスト計画に <code>Threads (Users)</code> -&gt; <code>スレッドグループ</code> を追加する。</p>
</li>
<li>
<p><strong>記録コントローラの作成</strong>
スレッドグループ内に <code>ロジックコントローラー</code> -&gt; <code>記録コントローラー</code> を追加する。</p>
</li>
</ol>
<p><img src="file:///Users/takada/Desktop/takada_personal/jmeter-project/docs/images/1-2.png" alt="記録コントローラー"></p>
<ol start="3">
<li><strong>HTTPプロキシサーバの設定</strong>
<code>Non-Testエレメント</code> -&gt; <code>HTTPプロキシサーバ</code> を追加する。
<ul>
<li><strong>ポート:</strong> <code>8888</code> (デフォルト)</li>
<li><strong>対象となるコントローラ:</strong> 手順2で作成した記録コントローラを選択</li>
</ul>
</li>
</ol>
<p><img src="file:///Users/takada/Desktop/takada_personal/jmeter-project/docs/images/1-4.png" alt="プロキシサーバ設定"></p>
<ol start="4">
<li><strong>フィルタリング設定 (Requests Filtering)</strong>
静的コンテンツ（画像、CSS、JSなど）を除外するため、「除外するパターン」に以下を設定する。</li>
</ol>
<pre class="hljs"><code><div>.*\.js.*
.*\.gif.*
.*\.svg.*
.*\.css.*
.*\.jpg.*
.*\.woff2.*
.*\.ico.*
.*\.png.*
.*\.woff.*
.*\.ttf.*
</div></code></pre>
<blockquote>
<p><strong>Note:</strong> 必要なドメインのみを記録する場合は「挿入するパターン」に <code>.*example\.com.*</code> のように記述する。</p>
</blockquote>
<ol start="5">
<li><strong>プロキシ設定と記録開始</strong>
ブラウザまたはOSのプロキシ設定をJMeter（デフォルトポート: 8888）に向ける。
[開始] ボタンを押下し、ブラウザを操作する。
<blockquote>
<p><strong>Note:</strong> この時点で <code>ApacheJMeterTemporaryRootCA.crt</code> がbinフォルダに生成される。証明書エラーが出る場合は <a href="#appendix-a-%E3%83%97%E3%83%AD%E3%82%AD%E3%82%B7%E3%81%A8https%E8%A8%BC%E6%98%8E%E6%9B%B8%E3%81%AE%E8%A8%AD%E5%AE%9A%E8%A9%B3%E7%B4%B0">Appendix A</a> を確認すること。</p>
</blockquote>
</li>
</ol>
<p><img src="file:///Users/takada/Desktop/takada_personal/jmeter-project/docs/images/1-7-3.png" alt="証明書インポート参考"></p>
<ol start="6">
<li>
<p><strong>不要なリクエストの整理</strong>
記録終了後、不要なリクエストを削除し、トランザクション名をわかりやすい名前に変更する。</p>
<blockquote>
<p><strong>Note:</strong> もし不要なリクエストが大量に存在する場合は、<code>4. フィルタリング設定 (Requests Filtering)</code>に戻り、「除外するパターン」に設定を追加することを推奨する。</p>
</blockquote>
</li>
</ol>
<p><img src="file:///Users/takada/Desktop/takada_personal/jmeter-project/docs/images/1-11.png" alt="リクエスト整理"></p>
<ol start="7">
<li><strong>動作確認</strong>
<code>リスナー</code> -&gt; <code>結果をツリーで表示</code> を追加し、再生ボタンで動作を確認する。</li>
</ol>
<p><img src="file:///Users/takada/Desktop/takada_personal/jmeter-project/docs/images/1-13.png" alt="動作確認"></p>
<h3 id="3-2-%E3%82%A2%E3%82%B5%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%A8%E7%94%BB%E9%9D%A2%E8%A1%A8%E7%A4%BA%E7%A2%BA%E8%AA%8D-%E6%A4%9C%E8%A8%BC">3-2. アサーションと画面表示確認 (検証)</h3>
<p>設定したシナリオにより想定された挙動をしているか、レスポンスや画面を確認する。</p>
<h4 id="%E3%82%A2%E3%82%B5%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3">アサーション</h4>
<p>レスポンスが正しく返ってきているか、HTTPステータスコードだけでなく中身で検証する。</p>
<ol>
<li>検証したいリクエストに対し <code>アサーション</code> -&gt; <code>アサーション</code> を追加する。</li>
</ol>
<p><img src="file:///Users/takada/Desktop/takada_personal/jmeter-project/docs/images/2-1.png" alt="アサーション追加"></p>
<ol start="2">
<li>「テストするパターン」に、成功時に必ず含まれるユニークな文字列（例: &quot;ログインしました&quot;）や固有の値（アカウント名やidなど）を設定する。</li>
</ol>
<p><img src="file:///Users/takada/Desktop/takada_personal/jmeter-project/docs/images/assertion.png" alt="アサーション設定例"></p>
<p>アサーションによる失敗例</p>
<p><img src="file:///Users/takada/Desktop/takada_personal/jmeter-project/docs/images/2-4.png" alt="パターン設定"></p>
<h4 id="%E5%AE%9F%E9%9A%9B%E3%81%AE%E7%94%BB%E9%9D%A2%E8%A1%A8%E7%A4%BA%E3%81%AE%E7%A2%BA%E8%AA%8D-html-debugging">実際の画面表示の確認 (HTML Debugging)</h4>
<p>JMeterはブラウザではないため、JavaScriptを描画しない。「結果をツリーで表示」リスナーで、以下の手順でHTMLを確認する。</p>
<ol>
<li>リスナー内の <code>Response Data</code> タブを選択する。</li>
<li>下部のプルダウンメニューから <code>Text</code> ではなく <strong><code>HTML (download resources)</code></strong> を選択する。</li>
<li>これにより、画像やCSSを含めた「ユーザーが見る実際の画面」に近い状態でレンダリング結果を確認できる。</li>
</ol>
<p><img src="file:///Users/takada/Desktop/takada_personal/jmeter-project/docs/images/display_HTML.png" alt="HTML表示"></p>
<h3 id="3-3-%E5%8B%95%E7%9A%84%E3%83%91%E3%83%A9%E3%83%A1%E3%83%BC%E3%82%BF%E3%81%AE%E5%87%A6%E7%90%86-correlation">3-3. 動的パラメータの処理 (Correlation)</h3>
<p>セッションIDやCSRFトークンなど、動的に変わる値をサーバーから取得して引き継ぐ設定を行う。</p>
<ol>
<li><strong>Cookieの管理</strong>
スレッドグループに <code>設定エレメント</code> -&gt; <code>HTTPクッキーマネージャ</code> を追加する。
「繰り返しごとにクッキーを破棄しますか？」にチェックを入れる。</li>
</ol>
<p><img src="file:///Users/takada/Desktop/takada_personal/jmeter-project/docs/images/3-3.png" alt="クッキーマネージャ"></p>
<ol start="2">
<li><strong>値の抽出 (Extractor)</strong>
レスポンスから値を抽出したいリクエストに対し、後処理を追加する（例: <code>正規表現抽出</code>、または推奨される <code>CSS Selector Extractor</code>）。</li>
</ol>
<p><img src="file:///Users/takada/Desktop/takada_personal/jmeter-project/docs/images/3-4.png" alt="正規表現抽出の設定"></p>
<table>
<thead>
<tr>
<th style="text-align:left">項目</th>
<th style="text-align:left">設定例</th>
<th style="text-align:left">備考</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">参照名</td>
<td style="text-align:left"><code>widValue</code></td>
<td style="text-align:left">変数名</td>
</tr>
<tr>
<td style="text-align:left">正規表現</td>
<td style="text-align:left"><code>wid=(.*?)&quot;</code></td>
<td style="text-align:left"><code>()</code>の中身が抽出される</td>
</tr>
<tr>
<td style="text-align:left">テンプレート</td>
<td style="text-align:left"><code>$1$</code></td>
<td style="text-align:left"></td>
</tr>
</tbody>
</table>
<ol start="3">
<li><strong>変数の利用</strong>
抽出した値を使用するリクエストのパラメータに <code>${変数名}</code> の形式で記述する。</li>
</ol>
<p><img src="file:///Users/takada/Desktop/takada_personal/jmeter-project/docs/images/3-6.png" alt="変数の利用"></p>
<ol start="4">
<li><strong>疎通確認</strong>
デバッグサンプラーやリスナーを用いて、値が正しく引き継がれているか確認する。</li>
</ol>
<p><img src="file:///Users/takada/Desktop/takada_personal/jmeter-project/docs/images/3-8.png" alt="疎通確認"></p>
<h3 id="3-4-%E5%A4%96%E9%83%A8%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E5%88%A9%E7%94%A8-csv-data-set">3-4. 外部データの利用 (CSV Data Set)</h3>
<p>ユーザーIDやパスワードなど、テストデータを外部ファイルから読み込む。</p>
<blockquote>
<p><strong>Warning:</strong> 顧客の個人情報など機密情報を使用する場合は、<code>.gitignore</code>などでGit管理対象外にすること</p>
</blockquote>
<ol>
<li>
<p><strong>CSVファイルの準備</strong>
読み込ませたいデータが入ったcsvファイルを準備する。</p>
</li>
<li>
<p><strong>CSV Data Set Configの設定</strong>
スレッドグループに <code>設定エレメント</code> -&gt; <code>CSV Data Set Config</code> を追加する。</p>
<p>以下図を参考に<code>CSV Data Set Config</code>の設定を行う。</p>
<table>
<thead>
<tr>
<th style="text-align:left">項目</th>
<th style="text-align:left">設定内容</th>
<th style="text-align:left">設定例</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Filename</td>
<td style="text-align:left">作成したCSVファイルのパスを入力する。<br>チーム間のディレクトリ構成を統一するためシナリオファイル(.jmx)からの相対パスで記述することを推奨する。</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">File encoding</td>
<td style="text-align:left">ファイルのエンコーディングと一致</td>
<td style="text-align:left">UTF-8</td>
</tr>
<tr>
<td style="text-align:left">Variable Names</td>
<td style="text-align:left">参照名をカンマ区切りで記載。Csvファイル内に記載の場合は空白</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">Ignore first line (CSV)</td>
<td style="text-align:left">ヘッダ行を除外するかどうか</td>
<td style="text-align:left">True or False</td>
</tr>
<tr>
<td style="text-align:left">Delimiter</td>
<td style="text-align:left">ファイルで使用している区切り文字を指定する。</td>
<td style="text-align:left">,</td>
</tr>
<tr>
<td style="text-align:left">Allow quoted data</td>
<td style="text-align:left">ダブルクォートで囲まれているかどうか</td>
<td style="text-align:left">True or False</td>
</tr>
<tr>
<td style="text-align:left">Recycle on EOF?</td>
<td style="text-align:left">全行利用した後に再利用するかどうか</td>
<td style="text-align:left">True or False</td>
</tr>
<tr>
<td style="text-align:left">Stop thread EOF</td>
<td style="text-align:left">再利用しない場合、スレッドを停止させるか</td>
<td style="text-align:left">True or False</td>
</tr>
<tr>
<td style="text-align:left">Sharing Mode</td>
<td style="text-align:left">複数のスレッド間でファイルを共有する（通常はこのままでOK）。</td>
<td style="text-align:left">All threads</td>
</tr>
</tbody>
</table>
</li>
<li>
<p><strong>設定した変数の利用</strong>
CSV Data Set Configで定義した変数をリクエストサンプラー内で使用する。</p>
<ol>
<li>データを使いたいHTTPリクエストサンプラーを開く。</li>
<li>データ入力欄の値を以下の形式で入力する。
入力例</li>
</ol>
<pre class="hljs"><code><div>${login_id}, ${login_pass}
</div></code></pre>
</li>
</ol>
<p><img src="file:///Users/takada/Desktop/takada_personal/jmeter-project/docs/images/4-4.png" alt="CSV設定"></p>
<h3 id="3-5-http%E3%83%98%E3%83%83%E3%83%80%E8%A8%AD%E5%AE%9A-referer">3-5. HTTPヘッダ設定 (Referer)</h3>
<p>Webサイトによっては、セキュリティ対策（CSRF対策など）として Referer ヘッダのチェックを行っている場合がある。
プロキシ記録時に自動で追加されることもあるが、手動で設定が必要な場合は以下の手順で行う。</p>
<ol>
<li>HTTPヘッダマネージャの追加 スレッドグループ（または特定のリクエスト）配下に 設定エレメント -&gt; HTTPヘッダマネージャ が存在することを確認する。なければ追加する。</li>
<li>Refererの名前に Referer、値に 遷移元のURL を入力する。</li>
</ol>
<p><img src="file:///Users/takada/Desktop/takada_personal/jmeter-project/docs/images/Referer.png" alt="リファラ設定"></p>
<h3 id="3-6-%E3%82%B7%E3%83%8A%E3%83%AA%E3%82%AA%E5%8B%95%E4%BD%9C%E6%A4%9C%E8%A8%BC%E3%81%A8%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0">3-6. シナリオ動作検証とトラブルシューティング</h3>
<p>シナリオ作成後、意図した通りに画面遷移（リクエスト）が行われない場合は、以下の観点で調査を行う。</p>
<h4 id="%E7%94%BB%E9%9D%A2%E9%81%B7%E7%A7%BB%E3%81%8C%E6%AD%A3%E5%B8%B8%E3%81%AB%E8%A1%8C%E3%82%8F%E3%82%8C%E3%81%AA%E3%81%84%E6%99%82%E3%81%AE%E7%A2%BA%E8%AA%8D%E3%83%AA%E3%82%B9%E3%83%88">画面遷移が正常に行われない時の確認リスト</h4>
<ul>
<li><strong>ブラウザでの動作確認</strong>: JMeterではなくブラウザから手動で操作して正常に遷移できるか。</li>
<li><strong>Cookieの受け渡し</strong>: 3-3 の設定に基づき HTTPクッキーマネージャ が有効になっており、リクエスト間でCookieが維持されているか（リスナーの「結果をツリーで表示」等で確認）。</li>
<li><strong>正規表現抽出の動作</strong>: 設定した正規表現（またはCSS Selector）で値が正しく抽出され、変数に格納されているか。</li>
<li><strong>抽出設定の不足</strong>: 他にも正規表現抽出の設定を入れなければならない動的パラメータ（トークン等）がないか。</li>
<li><strong>パラメータの比較</strong>: ブラウザで遷移した時のパラメータ（開発者ツールで確認）と、JMeterで遷移した場合のパラメータに差異がないか比較したか。</li>
</ul>
<h4 id="%E6%AD%A3%E8%A6%8F%E8%A1%A8%E7%8F%BE%E6%8A%BD%E5%87%BA%E3%81%AE%E8%A8%AD%E5%AE%9A%E5%AF%BE%E8%B1%A1%E3%81%8C%E3%82%8F%E3%81%8B%E3%82%89%E3%81%AA%E3%81%84%E6%99%82%E3%81%AEtodo">正規表現抽出の設定対象がわからない時のToDo</h4>
<p>動的なパラメータを特定するための手順</p>
<ol>
<li><strong>ブラウザでの画面遷移・パラメータ比較</strong>: ブラウザで画面遷移を何回か行い、その時に送られているリクエストパラメータを見比べる。</li>
<li><strong>動的値の特定</strong>: 同一条件で画面遷移を行なっても、パラメータの内容が変更になるものがあれば、それが正規表現抽出の対象である。</li>
<li><strong>入力情報の変更テスト</strong>: ログイン情報などの入力情報を変更してみて、パラメータが変更されたものについても、設定対象の可能性が高い。</li>
<li><strong>確認ツール</strong>: パラメータの確認は、ブラウザの「開発者ツール」のNetworkタブで行う。</li>
</ol>
<hr>
<h2 id="4-%E8%B2%A0%E8%8D%B7%E8%A9%A6%E9%A8%93%E8%A8%AD%E5%AE%9A-load-configuration">4. 負荷試験設定 (Load Configuration)</h2>
<h3 id="4-1-%E3%82%B9%E3%83%AC%E3%83%83%E3%83%89%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E8%A8%AD%E5%AE%9A">4-1. スレッドグループ設定</h3>
<p>負荷の基本量を設定する。</p>
<ul>
<li><strong>スレッド数:</strong> 同時接続ユーザー数に相当。</li>
<li><strong>Ramp-up期間:</strong> 全スレッドが起動するまでの時間。</li>
<li><strong>ループ回数:</strong> 各スレッドがシナリオ実行を繰り返す回数の指定。テスト期間中回し続ける場合は「無限」にチェックする。</li>
</ul>
<p><img src="file:///Users/takada/Desktop/takada_personal/jmeter-project/docs/images/5-2.png" alt="スレッドグループ設定"></p>
<h3 id="4-2-%E3%82%A8%E3%83%A9%E3%83%BC%E5%87%A6%E7%90%86">4-2. エラー処理</h3>
<p>負荷試験中にエラーが発生した場合の挙動を以下の表を参考に設定する。</p>
<table>
<thead>
<tr>
<th style="text-align:left">項目</th>
<th style="text-align:left">設定内容</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">続行</td>
<td style="text-align:left">エラーを気にせずテストを続行する</td>
</tr>
<tr>
<td style="text-align:left">StartNextThreadLoop</td>
<td style="text-align:left">終了し、次のループを開始する</td>
</tr>
<tr>
<td style="text-align:left">スレッド停止</td>
<td style="text-align:left">該当スレッドを停止する</td>
</tr>
<tr>
<td style="text-align:left">テスト停止</td>
<td style="text-align:left">該当テストを停止する</td>
</tr>
<tr>
<td style="text-align:left">StopTestNow</td>
<td style="text-align:left">即時テストを停止する</td>
</tr>
</tbody>
</table>
<p><img src="file:///Users/takada/Desktop/takada_personal/jmeter-project/docs/images/5-3.png" alt="エラー処理"></p>
<h3 id="4-3-%E6%80%9D%E8%80%83%E6%99%82%E9%96%93-think-time-%E3%81%AE%E8%A8%AD%E5%AE%9A">4-3. 思考時間 (Think Time) の設定</h3>
<p>ユーザーが画面を見て考えている時間をシミュレートし、リクエスト間隔を調整する。</p>
<ol>
<li><code>タイマ</code> -&gt; <code>一様乱数タイマ (Uniform Random Timer)</code> を追加する。</li>
</ol>
<table>
<thead>
<tr>
<th style="text-align:left">項目</th>
<th style="text-align:left">概要</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">常数タイマ</td>
<td style="text-align:left">一定乱数を使った待ち時間設定</td>
</tr>
<tr>
<td style="text-align:left">一様乱数タイマ</td>
<td style="text-align:left">乱数を使った待ち時間設定</td>
</tr>
<tr>
<td style="text-align:left">ガウス乱数タイマ</td>
<td style="text-align:left">ガウス分布を使った待ち時間設定</td>
</tr>
</tbody>
</table>
<p><img src="file:///Users/takada/Desktop/takada_personal/jmeter-project/docs/images/5-4.png" alt="一様乱数タイマ"></p>
<p><img src="file:///Users/takada/Desktop/takada_personal/jmeter-project/docs/images/5-4-2.png" alt="タイマ設定詳細"></p>
<ol start="2">
<li><code>リスナー</code> -&gt; <code>結果を表で表示</code> などで、意図した通りの待機時間が発生しているか確認する。</li>
</ol>
<p><img src="file:///Users/takada/Desktop/takada_personal/jmeter-project/docs/images/5-4-3.png" alt="タイマ確認"></p>
<h3 id="4-4-%E7%9B%AE%E6%A8%99%E3%82%B9%E3%83%AB%E3%83%BC%E3%83%97%E3%83%83%E3%83%88%E3%81%AE%E5%88%B6%E5%BE%A1-throughput-shaping-timer">4-4. 目標スループットの制御 (Throughput Shaping Timer)</h3>
<p>RPS（1秒あたりのリクエスト数）を固定したい場合に使用する。</p>
<ol>
<li><code>タイマ</code> -&gt; <code>jp@gc - Throughput Shaping Timer</code> を追加する。</li>
</ol>
<p><img src="file:///Users/takada/Desktop/takada_personal/jmeter-project/docs/images/5-5-1.png" alt="TST設定"></p>
<ol start="2">
<li><strong>負荷パターンの設定</strong>
「Start RPS」から「End RPS」へ、「Duration」秒かけて推移させる設定を行う。</li>
</ol>
<table>
<thead>
<tr>
<th style="text-align:left">項目</th>
<th style="text-align:left">概要</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Start Throughput</td>
<td style="text-align:left">開始時の負荷量を設定する</td>
</tr>
<tr>
<td style="text-align:left">End Throughput</td>
<td style="text-align:left">終了時の負荷量を設定する</td>
</tr>
<tr>
<td style="text-align:left">Duration</td>
<td style="text-align:left">継続時間を設定する</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>Warning:</strong> RPSはリクエスト数の単位であるため、シナリオが1ループにつき3つのHTTPリクエストを送信している場合、3 RPSは1 ループ/秒となる</p>
</blockquote>
<blockquote>
<p><strong>Warning:</strong> 分散環境(=workerサーバ複数台)での実行の場合、それぞれのworkerサーバでシナリオ実行がされるため、負荷対象サーバへの負荷は<code>設定したRPS</code> * <code>workerサーバの数</code>となってしまうことに注意</p>
</blockquote>
<ol start="3">
<li>
<p><strong>スレッド数の再調整</strong>
<code>Throughput Shaping Timer</code> (TST) で目標RPSを設定しても、<strong>スレッド数 (N)</strong> が不足していると、想定された負荷をかけられない。テスト実行後、結果に基づいてスレッド数を再調整する必要がある。</p>
<blockquote>
<p><strong>リトルの法則 (Little's Law)</strong>
性能テストにおける適切な同時実行スレッド数 (N) は、以下の式で求められる。
$$N \approx RPS \times T$$
ここで、<strong>RPS</strong> は目標とする1秒あたりのリクエスト数 (Throughput)、<strong>T</strong> はシナリオ1ループあたりの<strong>合計応答時間</strong>（秒）である。</p>
<p><em>T</em> は、シナリオの平均応答時間（Think Timeを含む）を参考に算出する。この N の値よりスレッド数が小さすぎると、TSTが設定した目標RPSを達成できない。</p>
</blockquote>
</li>
</ol>
<h3 id="4-5-%E3%82%B9%E3%83%AC%E3%83%83%E3%83%89%E6%95%B0%E3%81%AE%E5%86%8D%E8%AA%BF%E6%95%B4%E3%81%A8jmeter%E3%81%AE%E8%B2%A0%E8%8D%B7%E5%AF%BE%E7%AD%96">4-5. スレッド数の再調整とJMeterの負荷対策</h3>
<p>負荷を高くするためにスレッド数を調整する際、JMeter自身がボトルネックにならないよう注意が必要である。</p>
<ul>
<li>
<p><strong>JMeterサーバーの負荷確認:</strong>
スレッド数Nを大きくすると、JMeterを起動しているサーバー（クライアントマシン）自体の負荷（CPU使用率、メモリ使用率）が高くなる。</p>
</li>
<li>
<p><strong>負荷増強のための対応:</strong>
上記のリソース確認の結果、単一のJMeterサーバーでは目標とする負荷を達成できない場合、以下の対応が必要になる。</p>
<ol>
<li><strong>スケールアップ:</strong> JMeterサーバーのCPUやメモリを増強する。</li>
<li><strong>スケールアウト (分散環境の構築):</strong> JMeterの<strong>分散環境機能</strong>（Controller-Worker構成）を利用し、複数のマシンで負荷を分担して生成する。この機能を利用することで、単一サーバーの限界を超えた大規模な負荷試験が可能となる。</li>
</ol>
</li>
</ul>
<h3 id="4-6-%E6%9C%AC%E7%95%AA%E5%AE%9F%E8%A1%8C%E5%89%8D%E3%81%AE%E6%BA%96%E5%82%99">4-6. 本番実行前の準備</h3>
<ol>
<li><strong>リスナーの無効化</strong>
GUI実行用のリスナー（結果をツリーで表示など）はメモリを大量に消費するため、全て <strong>無効化</strong> または <strong>削除</strong> する。</li>
</ol>
<p><img src="file:///Users/takada/Desktop/takada_personal/jmeter-project/docs/images/5-6.png" alt="リスナー無効化"></p>
<ol start="2">
<li><strong>変数のパラメータ化</strong>
スレッド数やRamp-up期間は、実行時にコマンドラインから渡せるようにプロパティ関数 <code>__P()</code> を使用する。
例: <code>${__P(thread_num, 1)}</code></li>
</ol>
<p><img src="file:///Users/takada/Desktop/takada_personal/jmeter-project/docs/images/5-7.png" alt="プロパティ化"></p>
<hr>
<h2 id="5-%E3%83%86%E3%82%B9%E3%83%88%E5%AE%9F%E8%A1%8C-execution">5. テスト実行 (Execution)</h2>
<p>負荷試験は必ずCLI（Non-GUIモード）で実行する。
高負荷をかける際は、シナリオ内のリスナーを全て無効化する。</p>
<h3 id="5-1-%E5%AE%9F%E8%A1%8C%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89">5-1. 実行コマンド</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># 基本構文</span>
<span class="hljs-comment"># -n: Non-GUIモード</span>
<span class="hljs-comment"># -t: シナリオファイル(.jmx)</span>
<span class="hljs-comment"># -l: 結果ログ(.jtl)</span>
<span class="hljs-comment"># -e -o: HTMLレポート出力先</span>
<span class="hljs-comment"># -J変数名=値: プロパティの上書き</span>

jmeter -n -t scenario.jmx -l result.jtl -e -o report_folder -Jthread_num=10 -Jramp_up=60
</div></code></pre>
<h3 id="5-2-jmeter%E8%87%AA%E4%BD%93%E3%81%AE%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0">5-2. JMeter自体のトラブルシューティング</h3>
<p>負荷試験実行中にJMeterがフリーズする、または強制終了する場合、以下の要因を確認する。</p>
<h4 id="outofmemoryerror-java-heap-space">OutOfMemoryError: Java heap space</h4>
<p>JMeterはJavaアプリケーションであり、デフォルトのメモリ設定（ヒープサイズ）は低く（例: 1GB）設定されていることが多い。高負荷時にメモリ不足で落ちる場合は、ヒープサイズを拡張する。</p>
<p><strong>対応手順 (ローカル(CLI)実行時):</strong>
環境変数 <code>JVM_ARGS</code> でヒープサイズを指定して実行する。</p>
<pre class="hljs"><code><div><span class="hljs-comment"># 例: 最小4GB、最大4GBのヒープを割り当てる</span>
JVM_ARGS=<span class="hljs-string">"-Xms4g -Xmx4g"</span> jmeter -n -t scenario.jmx ...
</div></code></pre>
<p><strong>Linuxサーバー(worker)でのメモリ設定手順（systemd利用時）</strong>
分散環境のワーカーサーバー（jmeter-server）を サーバー常駐(systemd) でサービス化している場合、コマンドライン引数ではなく、ユニットファイルでの環境変数設定が必要となる。</p>
<ol>
<li>ユニットファイルを開く。</li>
</ol>
<pre class="hljs"><code><div>sudo vim /etc/systemd/system/jmeter-server.service
</div></code></pre>
<ol start="2">
<li>[Service] セクションに HEAP 環境変数を追記する。</li>
</ol>
<pre class="hljs"><code><div># ... (既存の設定)

# メモリ割り当て設定 (Environment=&quot;HEAP=-Xms&lt;サイズ&gt; -Xmx&lt;サイズ&gt;&quot;)
# 例: c6a.xlarge (Mem 8GiB) の場合
Environment=&quot;HEAP=-Xms6g -Xmx6g&quot;
</div></code></pre>
<ol start="3">
<li>設定を反映し、サービスを再起動する。</li>
</ol>
<pre class="hljs"><code><div>sudo systemctl daemon-reload
sudo systemctl restart jmeter-server.service
</div></code></pre>
<hr>
<h2 id="6-%E3%83%AC%E3%83%9D%E3%83%BC%E3%83%88%E8%A7%A3%E6%9E%90-result-analysis">6. レポート解析 (Result Analysis)</h2>
<p>手順5で生成されたレポートフォルダ内の index.html をブラウザで開くと、詳細なグラフレポートが確認できる。 ここでは、性能評価において特に注目すべき指標について解説する。</p>
<h3 id="6-1-dashboard-%E6%A6%82%E8%A6%81-%E3%81%AE%E8%A6%8B%E6%96%B9">6-1. Dashboard (概要) の見方</h3>
<p>トップページにある（Dashboard）にある Statistics テーブルは、テスト全体の集計結果である。</p>
<table>
<thead>
<tr>
<th style="text-align:left">項目</th>
<th style="text-align:left">日本語訳</th>
<th style="text-align:left">説明・評価ポイント</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><strong>Executions</strong></td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">Samples</td>
<td style="text-align:left">サンプル数</td>
<td style="text-align:left">リクエストの総数。シナリオ通りの負荷がかかったかの確認。</td>
</tr>
<tr>
<td style="text-align:left">FAIL</td>
<td style="text-align:left">エラー数</td>
<td style="text-align:left">失敗したリクエスト数。</td>
</tr>
<tr>
<td style="text-align:left">Error %</td>
<td style="text-align:left">エラー率</td>
<td style="text-align:left">全体に対する失敗の割合。</td>
</tr>
<tr>
<td style="text-align:left"><strong>Response Times (ms)</strong></td>
<td style="text-align:left">応答時間</td>
<td style="text-align:left">サーバーがリクエストを受け取ってから応答を返すまでの時間。</td>
</tr>
<tr>
<td style="text-align:left">Average</td>
<td style="text-align:left">平均</td>
<td style="text-align:left">全体の平均値。外れ値（極端に遅いリクエスト）の影響を受けやすい。</td>
</tr>
<tr>
<td style="text-align:left"><strong>90th / 95th / 99th pct</strong></td>
<td style="text-align:left">パーセンタイル</td>
<td style="text-align:left">例: 90th pctが 2000ms なら、「全アクセスの90%は2秒以内に完了した」ことを意味する。<br>一部の遅延を除いた実質的な体感速度を表す。</td>
</tr>
<tr>
<td style="text-align:left">Max</td>
<td style="text-align:left">最大値</td>
<td style="text-align:left">最も遅かったリクエストの時間。スパイク（一時的な詰まり）の有無を確認する。</td>
</tr>
<tr>
<td style="text-align:left">Transactions/s</td>
<td style="text-align:left">スループット</td>
<td style="text-align:left">1秒間に処理されたリクエスト数 (RPS)。<br>目標とする負荷（例: 100 RPS）が出ているか確認する。</td>
</tr>
</tbody>
</table>
<p><img src="file:///Users/takada/Desktop/takada_personal/jmeter-project/docs/images/report_dashboard_statics.png" alt="statics"></p>
<h3 id="6-2-%E9%87%8D%E8%A6%81%E3%81%AA%E3%82%B0%E3%83%A9%E3%83%95-charts">6-2. 重要なグラフ (Charts)</h3>
<p>左メニューの <code>Charts</code> から、時間の経過に伴う性能変化を確認する。</p>
<h4 id="1-response-time-over-time-%E5%BF%9C%E7%AD%94%E6%99%82%E9%96%93%E3%81%AE%E6%8E%A8%E7%A7%BB">1. Response Time Over Time (応答時間の推移)</h4>
<ul>
<li><strong>場所:</strong> <code>Charts</code> -&gt; <code>Over Time</code> -&gt; <code>Response Time Over Time</code></li>
<li><strong>見るべきポイント:</strong>
<ul>
<li>テスト後半にかけてグラフが右肩上がりになっていないか？（メモリリークやDB詰まりの兆候）</li>
<li>特定の時間帯にスパイク（急激な跳ね上がり）がないか？（GC発生やAuto Scalingの遅れなど）</li>
</ul>
</li>
</ul>
<p><img src="file:///Users/takada/Desktop/takada_personal/jmeter-project/docs/images/report_charts_responsetime.png" alt="response time"></p>
<h4 id="2-transactions-per-second-%E3%82%B9%E3%83%AB%E3%83%BC%E3%83%97%E3%83%83%E3%83%88%E3%81%AE%E6%8E%A8%E7%A7%BB">2. Transactions Per Second (スループットの推移)</h4>
<ul>
<li><strong>場所:</strong> <code>Charts</code> -&gt; <code>Throughput</code> -&gt; <code>Transactions Per Second</code></li>
<li><strong>見るべきポイント:</strong>
<ul>
<li>設定した負荷（RPS）通りにリクエストが送信され、処理されているか。</li>
<li>応答時間の悪化と共にスループットが低下していないか（システム限界の到達）。</li>
</ul>
</li>
</ul>
<p><img src="file:///Users/takada/Desktop/takada_personal/jmeter-project/docs/images/report_charts_transactionsPS.png" alt="Throughput Transactions"></p>
<h4 id="3-active-threads-over-time-%E5%90%8C%E6%99%82%E6%8E%A5%E7%B6%9A%E6%95%B0%E3%81%AE%E6%8E%A8%E7%A7%BB">3. Active Threads Over Time (同時接続数の推移)</h4>
<ul>
<li><strong>場所:</strong> <code>Charts</code> -&gt; <code>Over Time</code> -&gt; <code>Active Threads Over Time</code></li>
<li><strong>見るべきポイント:</strong>
<ul>
<li>設定したスレッド数通りに推移しているか。</li>
<li>エラー発生時にスレッドが異常終了して減っていないか。</li>
</ul>
</li>
</ul>
<p><img src="file:///Users/takada/Desktop/takada_personal/jmeter-project/docs/images/report_charts_activeThreads.png" alt="Active Threads over time"></p>
<hr>
<h2 id="appendix-a-%E3%83%97%E3%83%AD%E3%82%AD%E3%82%B7%E3%81%A8https%E8%A8%BC%E6%98%8E%E6%9B%B8%E3%81%AE%E8%A8%AD%E5%AE%9A%E8%A9%B3%E7%B4%B0">Appendix A. プロキシとHTTPS証明書の設定詳細</h2>
<p>JMeterでHTTPSサイト（暗号化された通信）をキャプチャするためには、JMeterが発行する「自己署名証明書」をPCに信頼させる必要がある。
これを行わない場合、ブラウザで「この接続はプライバシーが保護されていません」等のエラーが出て先に進めない。</p>
<h3 id="a-1-%E8%A8%BC%E6%98%8E%E6%9B%B8%E3%81%AE%E7%94%9F%E6%88%90">A-1. 証明書の生成</h3>
<ol>
<li>JMeterの「HTTPプロキシサーバ」で [開始] ボタンを押す。</li>
<li>以下のダイアログが表示される。
<blockquote>
<p>CA certificate ... Created in JMeter bin directory</p>
</blockquote>
</li>
<li>JMeterの <code>bin</code> ディレクトリ（<code>/libexec/bin</code> 等）に <code>ApacheJMeterTemporaryRootCA.crt</code> というファイルが生成される。
<strong>有効期限は7日間</strong> であるため、期限切れの際は再生成と再インストールが必要になる。</li>
</ol>
<h3 id="a-2-%E8%A8%BC%E6%98%8E%E6%9B%B8%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB-macos--chrome%E3%81%AE%E5%A0%B4%E5%90%88">A-2. 証明書のインストール (MacOS / Chromeの場合)</h3>
<p>Chromeは、OS（Mac）のキーチェーン設定を参照する。</p>
<ol>
<li>生成された <code>ApacheJMeterTemporaryRootCA.crt</code> をダブルクリックする。</li>
<li>「キーチェーンアクセス」が開くので、ログインキーチェーンに追加する。</li>
<li>追加された証明書（JMeter Root CA）をダブルクリックする。</li>
<li><strong>「信頼 (Trust)」</strong> セクションを開き、「この証明書を使用するとき」を <strong>「常に信頼 (Always Trust)」</strong> に変更する。</li>
</ol>
<h3 id="a-3-macos%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E3%83%97%E3%83%AD%E3%82%AD%E3%82%B7%E3%81%AE%E8%A8%AD%E5%AE%9A">A-3. macOSネットワークプロキシの設定</h3>
<p>ブラウザ（Chrome/Safari）の通信をJMeter経由にするため、OSのネットワーク設定を変更する。</p>
<ol>
<li><strong>設定画面を開く</strong>
<code>システム設定</code> -&gt; <code>ネットワーク</code> -&gt; <code>Wi-Fi</code>（有線の場合はEthernet） -&gt; <code>詳細...</code> をクリックする。</li>
<li><strong>プロキシタブの選択</strong>
左側のメニューから <code>プロキシ</code> を選択する。</li>
<li><strong>HTTPとHTTPSの設定</strong>
以下の2項目をスイッチを <strong>ON</strong> にし、それぞれ設定する。
<ul>
<li><strong>Webプロキシ (HTTP)</strong>
<ul>
<li>サーバ: <code>localhost</code></li>
<li>ポート: <code>8888</code></li>
</ul>
</li>
<li><strong>保護されたWebプロキシ (HTTPS)</strong>
<ul>
<li>サーバ: <code>localhost</code></li>
<li>ポート: <code>8888</code></li>
</ul>
</li>
</ul>
</li>
</ol>
<p><img src="file:///Users/takada/Desktop/takada_personal/jmeter-project/docs/images/1-7-3.png" alt="証明書インポート参考">
4. <strong>設定の適用（重要）</strong>
[OK] をクリックして詳細画面を閉じた後、ネットワーク設定画面右下の <strong>[適用] ボタンを必ずクリックする</strong>。これを行わないと設定が反映されない。</p>
<blockquote>
<p><strong>Warning:</strong> 記録終了後は、必ず上記2つのプロキシ設定を <strong>OFF</strong> に戻し、再度 [適用] すること。戻し忘れるとインターネットに繋がらなくなる。</p>
</blockquote>
<h3 id="a-4-%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0">A-4. トラブルシューティング</h3>
<ul>
<li>
<p><strong>Q. キャプチャが始まらない / サイトにつながらない</strong></p>
<ul>
<li><strong>A1.</strong> JMeterのプロキシサーバが [開始] 状態になっているか確認する。</li>
<li><strong>A2.</strong> ブラウザのプロキシ設定が <code>localhost</code> : <code>8888</code> になっているか確認する。</li>
</ul>
</li>
<li>
<p><strong>Q. &quot;Your connection is not private&quot; エラーが消えない</strong></p>
<ul>
<li><strong>A.</strong> 証明書の有効期限（7日）が切れている可能性がある。JMeterのbinフォルダにある <code>crt</code> ファイルと <code>proxyserver.jks</code> を削除し、JMeterを再起動してプロキシを開始（再生成）した後、再度インストール手順を行う。</li>
</ul>
</li>
</ul>
<hr>
<h2 id="appendix-b-%E3%83%A1%E3%83%BC%E3%83%AB%E5%8F%96%E5%BE%97%E6%A9%9F%E8%83%BD-mail-reader-sampler">Appendix B. メール取得機能 (Mail Reader Sampler)</h2>
<p>会員登録やパスワードリセットなど、メールで送られてくる「認証コード」や「URL」をテスト内で取得する場合、JMeter標準の <strong>Mail Reader Sampler</strong> を使用する。</p>
<h3 id="b-1-%E5%89%8D%E6%8F%90%E6%9D%A1%E4%BB%B6-google%E3%82%A2%E3%82%AB%E3%82%A6%E3%83%B3%E3%83%88%E3%81%AE%E8%A8%AD%E5%AE%9A-gmail%E3%81%AE%E5%A0%B4%E5%90%88">B-1. 前提条件: Googleアカウントの設定 (Gmailの場合)</h3>
<p>通常のGmailパスワードでは、セキュリティ設定（2段階認証など）によりIMAP接続が拒否される場合が多い。必ず <strong>アプリパスワード</strong> を生成して使用すること。</p>
<ol>
<li>Googleアカウント管理画面へアクセスする。</li>
<li>セキュリティ設定から「アプリパスワード」を生成する。
<ul>
<li>参考: <a href="https://support.google.com/accounts/answer/185833">アプリ パスワードでログインする - Google アカウント ヘルプ</a></li>
</ul>
</li>
<li>生成された16桁のパスワードを控えておく（これがJMeter設定時のパスワードになる）。</li>
</ol>
<h3 id="b-2-%E3%83%A1%E3%83%BC%E3%83%AB%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E6%8E%A5%E7%B6%9A%E8%A8%AD%E5%AE%9A-troubleshooting">B-2. メールサーバー接続設定 (Troubleshooting)</h3>
<p>接続時に <code>No appropriate protocol</code> エラーが出る場合、JMeterが古い暗号化方式を使おうとしている可能性がある。以下の設定を行う。</p>
<ol>
<li>JMeterの <code>bin</code> ディレクトリにある <code>system.properties</code> をエディタで開く。</li>
<li>末尾に以下の行を追加して保存し、JMeterを再起動する。<pre class="hljs"><code><div><span class="hljs-meta">mail.imaps.ssl.protocols</span>=<span class="hljs-string">TLSv1.2 TLSv1.3</span>
</div></code></pre>
</li>
</ol>
<h3 id="b-3-mail-reader-sampler-%E3%81%AE%E8%A8%AD%E5%AE%9A%E6%89%8B%E9%A0%86">B-3. Mail Reader Sampler の設定手順</h3>
<ol>
<li><strong>サンプラーの追加</strong>
スレッドグループに対し、<code>サンプラー</code> -&gt; <code>Mail Reader Sampler</code> を追加する。</li>
</ol>
<p><img src="file:///Users/takada/Desktop/takada_personal/jmeter-project/docs/images/mail_ref1-1.png" alt="Mail Reader設定参考"></p>
<ol start="2">
<li>
<p><strong>接続情報の入力</strong>
Gmailを受信する場合の標準的な設定は以下の通り。</p>
<table>
<thead>
<tr>
<th style="text-align:left">項目</th>
<th style="text-align:left">設定値</th>
<th style="text-align:left">備考</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Protocol</td>
<td style="text-align:left"><code>imaps</code></td>
<td style="text-align:left">安全な接続(SSL)を使用</td>
</tr>
<tr>
<td style="text-align:left">Server Host</td>
<td style="text-align:left"><code>imap.gmail.com</code></td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">Port</td>
<td style="text-align:left"><code>993</code></td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">Username</td>
<td style="text-align:left"><code>your_email@gmail.com</code></td>
<td style="text-align:left">テスト用アドレス</td>
</tr>
<tr>
<td style="text-align:left">Password</td>
<td style="text-align:left"><code>${__P(mail_pass)}</code></td>
<td style="text-align:left"><strong>手順B-1で取得したアプリパスワード</strong></td>
</tr>
<tr>
<td style="text-align:left">Folder</td>
<td style="text-align:left"><code>INBOX</code></td>
<td style="text-align:left">受信トレイ</td>
</tr>
<tr>
<td style="text-align:left">Number of messages</td>
<td style="text-align:left"><code>1</code></td>
<td style="text-align:left">最新の1件のみ取得</td>
</tr>
</tbody>
</table>
</li>
</ol>
<blockquote>
<p><strong>Note:</strong> <code>${__P(mail_pass)}</code>については実行時にコマンドライン引数 -Jmail_pass=アプリパスワード で渡すこと</p>
</blockquote>
<ol start="3">
<li><strong>セキュリティ設定</strong>
<ul>
<li>「Enforce StartTLS」はチェック不要（imapsプロトコルを使用するため）。</li>
<li>「Trust All Certificates」にはチェックを入れる（証明書エラー回避のため）。</li>
</ul>
</li>
</ol>
<h3 id="b-4-%E3%83%A1%E3%83%BC%E3%83%AB%E6%9C%AC%E6%96%87%E3%81%8B%E3%82%89%E3%81%AE%E3%83%87%E3%83%BC%E3%82%BF%E6%8A%BD%E5%87%BA">B-4. メール本文からのデータ抽出</h3>
<p>メール本文から「認証コード」などを抜き出すには、後処理（PostProcessor）を使用する。</p>
<h4 id="%E6%96%B9%E6%B3%95a-%E6%AD%A3%E8%A6%8F%E8%A1%A8%E7%8F%BE%E6%8A%BD%E5%87%BA%E6%8E%A8%E5%A5%A8%E3%83%BB%E7%B0%A1%E5%8D%98">方法A: 正規表現抽出（推奨・簡単）</h4>
<ol>
<li>Mail Reader Sampler の子要素に <code>後処理</code> -&gt; <code>正規表現抽出</code> を追加する。</li>
<li>以下の例を参考に設定する。
<ul>
<li><strong>Apply to:</strong> Main sample only</li>
<li><strong>Field to check:</strong> Body</li>
<li><strong>正規表現:</strong> <code>コード: (\d{6})</code> ※メール本文の形式に合わせる</li>
<li><strong>テンプレート:</strong> <code>$1$</code></li>
<li><strong>参照名:</strong> <code>verification_code</code></li>
</ul>
</li>
</ol>
<h4 id="%E6%96%B9%E6%B3%95b-jsr223-postprocessor-groovy">方法B: JSR223 PostProcessor (Groovy)</h4>
<p>複雑な条件（例：件名でフィルタリングしたい、特定のHTMLタグの中身が欲しい等）がある場合は、スクリプトを使用する。</p>
<ol>
<li>Mail Reader Sampler の子要素に <code>後処理</code> -&gt; <code>JSR223 PostProcessor</code> を追加する。</li>
<li>言語に <code>groovy</code> を選択し、スクリプトを記述する。</li>
</ol>
<p>スクリプトの例</p>
<pre class="hljs"><code><div><span class="hljs-comment">// レスポンス（メール本文）を文字列として取得</span>
String emailBody = prev.getResponseDataAsString();

<span class="hljs-comment">// 正規表現で6桁の数字を探す例</span>
<span class="hljs-keyword">def</span> matcher = (emailBody =~ <span class="hljs-regexp">/([0-9]{6})/</span>);

<span class="hljs-keyword">if</span> (matcher.find()) {
    <span class="hljs-comment">// 見つかった場合、変数 "verification_code" に格納</span>
    vars.put(<span class="hljs-string">"verification_code"</span>, matcher[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>]);
    log.info(<span class="hljs-string">"Code found: "</span> + matcher[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>]);
} <span class="hljs-keyword">else</span> {
    log.warn(<span class="hljs-string">"Code not found in email."</span>);
}
</div></code></pre>
<h3 id="b-5-%E5%8F%96%E5%BE%97%E3%81%97%E3%81%9F%E5%80%A4%E3%81%AE%E5%88%A9%E7%94%A8">B-5. 取得した値の利用</h3>
<p>抽出・格納された変数は、以降のHTTPリクエストのパラメータとして利用できる。</p>
<ul>
<li><strong>利用例:</strong> 認証画面へのPOSTリクエスト
<ul>
<li>パラメータ名: <code>code</code></li>
<li>値: <code>${verification_code}</code></li>
</ul>
</li>
</ul>
<hr>

</body>
</html>
